<html>
<head>
  <meta charset="utf-8">
  <title>Mocha Tests</title>
  <link rel="stylesheet"
    href="http://nathansuniversity.com/css/mocha.css" />
  <script src="http://nathansuniversity.com/js/jquery-1.7.1.min.js">
  </script>
  <script src="http://nathansuniversity.com/js/chai.js">
  </script>
  <script src="http://nathansuniversity.com/js/mocha.js">
  </script>
  <script>mocha.setup('tdd')</script>
  <script src="parser.js"></script>
  <script src="interpreter.js">
  </script>
  <script>
    var evalScheemString = function(s, env) {
        return evalScheem(SCHEEM.parse(s), env)
    };

    var assert = chai.assert;


    // Some unit tests

    suite('quote', function() {
        test('a number', function() {
            assert.deepEqual(
                evalScheem(['quote', 3], {}),
                3
            );
        });
        test('an atom', function() {
            assert.deepEqual(
                evalScheem(['quote', 'dog'], {}),
                'dog'
            );
        });
        test('a list', function() {
            assert.deepEqual(
                evalScheem(['quote', [1, 2, 3]], {}),
                [1, 2, 3]
            );
        });
    });
    suite('arithmetic', function() {
        test('three threes', function() {
            assert.deepEqual(
                evalScheem(['+', 3, 3, ['+', 1, 2]], {}),
                9
            );
        });
		test('one arg +', function() {
            assert.deepEqual(
                evalScheem(['+', 3], {}),
                3
            );
        });
		test('one arg -', function() {
            assert.deepEqual(
                evalScheem(['-', 3], {}),
                -3
            );
        });
		test('one arg *', function() {
            assert.deepEqual(
                evalScheem(['*', 3], {}),
                3
            );
        });
		test('one arg /', function() {
            assert.deepEqual(
                evalScheem(['/', 2], {}),
                1 / 2
            );
        });
        test('two and two', function() {
            assert.deepEqual(
                evalScheem(['+', 2, 2], {}),
                4
            );
        });
        test('a number and an expression', function() {
            assert.deepEqual(
                evalScheem(['+', 3, ['+', 2, 2]], {}),
                7
            );
        });
        test('subtraction', function() {
            assert.deepEqual(
                evalScheem(['-', 100, 88], {}),
                12
            );
        });
        test('multiply and divide', function() {
            assert.deepEqual(
                evalScheem(['/', ['*', 10, 10], ['*', 5, 5]], {}),
                4
            );
        });
    });
    suite('cons, car, cdr', function() {

        test('cons', function() {
            assert.deepEqual(
            evalScheem(['cons', 1, ['quote', [2, 3]]], {}),
                [1, 2, 3]
            );
        });
        test('car', function() {
            assert.deepEqual(
            evalScheem(['car', ['cons', 1, ['quote', [2, 3]]]], {}),
                1
            );
        });
        test('cdr', function() {
            assert.deepEqual(
            evalScheem(['cdr', ['cons', 1, ['quote', [2, 3]]]], {}),
                [2, 3]
            );
        });

    });
    suite('comparison', function() {
        // remember, = is for numbers
        test('=', function() { 
            assert.deepEqual(
            evalScheem(['=', 100, 100], {}), '#t');
        });
        test('<', function() {
            assert.deepEqual(
            evalScheem(['<', 10, 2], {}), '#f');
        });
		test('1 < 2 < 3 should be #t', function() {
            assert.deepEqual(
            evalScheem(['<', 1, 2, 3], {}), '#t');
        });
		test('1 < 2 < 1 should be #f', function() {
            assert.deepEqual(
            evalScheem(['<', 1, 2, 1], {}), '#f');
        });
    });
    
    suite('if test', function() {
        test('if 1 == 2 the divide 1 by 0, else 1', function() { 
            assert.deepEqual(
            evalScheem(['if', ['=', 1, 2], ['/', 1, 0], 1 ], {}), 1);
        });
    });

    suite('begin', function() {
        test('begin block', function() { 
            assert.deepEqual(
            evalScheem(['begin', ['+', 1, 2], ['-', 1, 0], 1 ], {}), 1);
        });
        test('begin block with define', function() { 
            assert.deepEqual(
            evalScheem(['begin', ['define', 'a', 2], 2 ], {}), 2);
        });
        test('begin block with define, set, and initial env', function() { 
            assert.deepEqual(
            evalScheem(['begin', ['define', 'a1', 2], ['set!', 'a1', 3], ['+', "b", "a1" ]], 
                       {'b': 9}), 12);
        });

    });

	suite('Error handling', function() {
		test('bad assign', function () {
				assert.throws(function () {
				    evalScheem(['define', "a", 2, 2], {});
			});
		});
		test('assign to number', function () {
				assert.throws(function () {
				    evalScheem(['define', 1, 2], {});
			});
		});
		test('good assign - list', function () {
				assert.doesNotThrow(function () {
				    evalScheem(['define', "a", ['quote', [2, 2]]], {});
			});
		});
		test('good assign - atom', function () {
				assert.doesNotThrow(function () {
				    evalScheem(['define', "a", 1], {});
			});
		});
		test('bad set! to undefined symbol', function () {
				assert.throws(function () {
				    evalScheem(['set!', "a2", 1], {});
			});
		});
		test('bad + - adding string that are not in env', function () {
				assert.throws(function () {
				    evalScheem(['+', "a", "a"], {});
			});
		});
		test('good + - adding expressions with number values', function () {
				assert.doesNotThrow(function () {
				    evalScheem(['+', 1, ['-', 4, 2]], {});
			});
		});
		test('good + - one argument', function () {
				assert.doesNotThrow(function () {
				    evalScheem(['+', 1], {});
			});
		});
		test('good - : one argument', function () {
				assert.doesNotThrow(function () {
				    evalScheem(['-', 1], {});
			});
		});

    });

    suite('parse', function() {
        test('a number', function() {
            assert.deepEqual(
                SCHEEM.parse('42'),
                42
            );
        });
	test('a variable', function() {
	    assert.deepEqual(
	    SCHEEM.parse('x'),
	    'x'
            );
	});
    });

    suite('evalScheemString tests', function() {
        test('a number', function() {
            assert.deepEqual(
                evalScheemString('42', {}),
                42
            );
        });
	test('add 2 and 2', function() {
            assert.deepEqual(
                evalScheemString('(+ 2 2)', {}),
                4
            );
        });
        test('cons 1 on to (2 3)', function() {
            assert.deepEqual(
                evalScheemString("(cons 1 '(2 3))", {}),
                [1, 2, 3]
            );
        });
        test('begin with define a as 2, then multiply a * a', function() {
            assert.deepEqual(
                evalScheemString("(begin (define a 2) (* a a) )", {}),
                4
            );
        });
        test('set a 2', function() {
            assert.deepEqual(
                evalScheemString("(set! a3 2)", {"a3": 0}),
                0
            );
        });
        test('begin with define, set! a = a + 2, and multiply', function() {
            assert.deepEqual(
                evalScheemString("(begin (define a 0) (set! a (+ a 2)) (* a a) )", {}),
                4
            );
        });
	
    });

  </script>
  <script>
    $(function(){
      mocha.run();
    });
  </script>
</head>
<body>
  <div id="mocha"></div>
</body>
</html>
